<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3d</title>

    <style>
    html {
        height: 100%;
    }
    body {
        margin: 0;
        padding: 0;
        min-height: 100%;
        background: #49b293;
        overflow:hidden;
        -webkit-overflow-scrolling: touch;
    }
    canvas {
        width: 100vw;
        height: 100vh;
        background: #eee;
      }
    </style>
    <script>
        var key = {w:0,a:0,s:0,d:0,space:0,ctrl:0};
        var pl_blsu = [5,5,5,5,5,5];
        var plg = 0;
        var pl_item = 1;
        var camera = {x:0,y:0};//각도
        var gijun = {point:[
            {x:-50,y:-50,z:-50},
            {x:50,y:-50,z:-50},
            {x:50,y:50,z:-50},
            {x:-50,y:50,z:-50},
            {x:-50,y:-50,z:50},
            {x:50,y:-50,z:50},
            {x:50,y:50,z:50},
            {x:-50,y:50,z:50}],origin:{x:0,y:0,z:0}};//기준이 되는 0,0,0위치의 블록, 위치는 카메라와의 상대 거리

        var bfs_list = [];
        var randerrange = 20;

        var img_grass = new Image();
        img_grass.src = "https://i.etsystatic.com/10800838/r/il/fb4f68/2825858925/il_570xN.2825858925_s5dq.jpg";

        var map = new Array(300);
        for (var i = 0; i < 300; i++) {
            map[i] = new Array(300);
            for (var j = 0; j < 300; j++) {
                map[i][j] = new Array(301);
                for (var k = 0; k < 300; k++) {
                    map[i][j][k] = 0;
                    if(k == 155){
                        map[i][j][k] = 1;
                    }
                    if(k > 155){
                        map[i][j][k] = 2;
                    }
                    if(!getRandomInt(0,50)){
                        map[i][j][k] = getRandomInt(0,7);
                    }
                }
            }
        }
        
        var map2 = new Array(300);
        for (var i = 0; i < 300; i++) {
            map2[i] = new Array(300);
            for (var j = 0; j < 300; j++) {
                map2[i][j] = new Array(301);
                for (var k = 0; k < 300; k++) {
                    map2[i][j][k] = 0;
                }
            }
        }

        document.addEventListener('keydown', (event) => {
                if (event.key == 's') {
                    key.s = 1;
                }
                if (event.key == 'w') {
                    key.w = 1;
                }
                if (event.key == 'a') {
                    key.a = 1;
                }
                if (event.key == 'd') {
                    key.d = 1;
                }
                if (event.key == ' ') {
                    key.space = 1;
                }
                if (event.keyCode == 17) {
                    key.ctrl = 1;
                }
                if (event.key == '=') {
                    randerrange += 1;
                }
                if (event.key == '-') {
                    randerrange -= 1;
                }
                if (event.key == '1') {
                    pl_item = 1;
                }
                if (event.key == '2') {
                    pl_item = 2;
                }
                if (event.key == '3') {
                    pl_item = 3;
                }
                if (event.key == '4') {
                    pl_item = 4;
                }
                if (event.key == '5') {
                    pl_item = 5;
                }
                if (event.key == '6') {
                    pl_item = 6;
                }
            });
            

            document.addEventListener('keyup', (event) => {
                if (event.key == 's') {
                    key.s = 0;
                }
                if (event.key == 'w') {
                    key.w = 0;
                }
                if (event.key == 'a') {
                    key.a = 0;
                }
                if (event.key == 'd') {
                    key.d = 0;
                }
                if (event.key == ' ') {
                    key.space = 0;
                }
                if (event.keyCode == 17) {
                    key.ctrl = 0;
                }
            });

            
            document.addEventListener("mousemove", (event) => {
                var mx = event.movementX;
                var my = event.movementY;
                
                gijunanglechange(1,-camera.y);
                gijunanglechange(0,mx/10*Math.PI/180);
                gijunanglechange(1,camera.y);

                gijunanglechange(1,my/10*Math.PI/180);

                
                camera.x += mx/10*Math.PI/180;
                camera.y += my/10*Math.PI/180;

            },false);

            document.addEventListener("mousedown", (event) => {
                if(event.button == 0 && !key.ctrl){
                    var dum = 0;
                    while(plblocknum() == 0 && dum > -500){
                        gijun.origin.x -= 10;
                        dum -= 10;
                    }
                    if(dum > -500){
                        gijunanglechange(1,-camera.y);
                        gijunanglechange(0,-camera.x);
                        pl_blsu[map[Math.ceil(-gijun.origin.x/100+150-0.5)][Math.ceil(-gijun.origin.y/100+150-0.5)][Math.ceil(-gijun.origin.z/100+150-0.5)]-1]+=1;
                        map[Math.ceil(-gijun.origin.x/100+150-0.5)][Math.ceil(-gijun.origin.y/100+150-0.5)][Math.ceil(-gijun.origin.z/100+150-0.5)] = 0;
                        gijunanglechange(0,camera.x);
                        gijunanglechange(1,camera.y);
                    }
                    gijun.origin.x -= dum;
                }
                else if(event.button == 1 || (event.button == 0 && key.ctrl) && pl_blsu[pl_item-1] > 0){
                    pl_blsu[pl_item-1] -= 1;
                    var dum = 0;
                    while(plblocknum() == 0 && dum > -500){
                        gijun.origin.x -= 10;
                        dum -= 10;
                    }
                    if(dum > -500){
                        gijun.origin.x += 10;
                        dum += 10;
                        gijunanglechange(1,-camera.y);
                        gijunanglechange(0,-camera.x);
                        map[Math.ceil(-gijun.origin.x/100+150-0.5)][Math.ceil(-gijun.origin.y/100+150-0.5)][Math.ceil(-gijun.origin.z/100+150-0.5)] = pl_item;
                        gijunanglechange(0,camera.x);
                        gijunanglechange(1,camera.y);
                    }
                    gijun.origin.x -= dum;
                    gijunanglechange(1,-camera.y);
                    if(plcol()){
                        gijunanglechange(1,camera.y);
                        gijun.origin.x += dum;
                        gijunanglechange(1,-camera.y);
                        gijunanglechange(0,-camera.x);
                        map[Math.ceil(-gijun.origin.x/100+150-0.5)][Math.ceil(-gijun.origin.y/100+150-0.5)][Math.ceil(-gijun.origin.z/100+150-0.5)] = 0;
                        pl_blsu[pl_item-1] += 1;
                        gijunanglechange(0,camera.x);
                        gijunanglechange(1,camera.y);
                        gijun.origin.x -= dum;
                    }
                    else{
                        gijunanglechange(1,camera.y);
                    }
                }

            },false);

        //drawtri({x:1,y:2},{x:100,y:200},{x:150,y:500},'#FF00FF');

        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min)) + min; //최댓값은 제외, 최솟값은 포함
        }

        function pointerlockon(element){

            element.requestPointerLock = element.requestPointerLock ||
                 element.mozRequestPointerLock ||
                 element.webkitRequestPointerLock;
            // Ask the browser to lock the pointer
            element.requestPointerLock();
        }
        
        function drawtri(vt21,vt22,vt23,color) {
            var canvas = document.getElementById("canvas");
            if (canvas.getContext) {
                var ctx = canvas.getContext("2d");

                ctx.beginPath();
                ctx.moveTo(vt21.x, vt21.y);
                ctx.lineTo(vt22.x, vt22.y);
                ctx.lineTo(vt23.x, vt23.y);
                ctx.fillStyle = color;
                ctx.fill();
                ctx.closePath();
            }
        }

        function drawgijunpoint_tri(a,b,c,color){
            if(gijun.point[a].x > 0 && gijun.point[b].x > 0 && gijun.point[c].x > 0){
                drawtri(
                    {x:gijun.point[a].y*500/gijun.point[a].x+1280/2,y:gijun.point[a].z*500/gijun.point[a].x+720/2},
                    {x:gijun.point[b].y*500/gijun.point[b].x+1280/2,y:gijun.point[b].z*500/gijun.point[b].x+720/2},
                    {x:gijun.point[c].y*500/gijun.point[c].x+1280/2,y:gijun.point[c].z*500/gijun.point[c].x+720/2},color);
            }
        }
        function drawgijunpoint_tri2(a,b,c,d,e,f,color,dum){
            if(gijun.point[a].x > 0 && gijun.point[b].x > 0 && gijun.point[c].x > 0){
                
                var gijunhis = {point:[
                    {x:-50,y:-50,z:-50},
                    {x:50,y:-50,z:-50},
                    {x:50,y:50,z:-50},
                    {x:-50,y:50,z:-50},
                    {x:-50,y:-50,z:50},
                    {x:50,y:-50,z:50},
                    {x:50,y:50,z:50},
                    {x:-50,y:50,z:50}],origin:{x:0,y:0,z:0}};//기준이 되는 0,0,0위치의 블록, 위치는 카메라와의 상대 거리

                for (var i = 0; i < 8; i++) {
                    gijunhis.point[i].x = gijun.point[i].x;
                    gijunhis.point[i].y = gijun.point[i].y;
                    gijunhis.point[i].z = gijun.point[i].z;
                }

                gijun.point[a].x = (gijunhis.point[a].x*dum+gijunhis.point[d].x)/(dum+1);
                gijun.point[a].y =(gijunhis.point[a].y*dum+gijunhis.point[d].y)/(dum+1);
                gijun.point[a].z = (gijunhis.point[a].z*dum+gijunhis.point[d].z)/(dum+1);
                
                gijun.point[b].x = (gijunhis.point[b].x*dum+gijunhis.point[e].x)/(dum+1);
                gijun.point[b].y =(gijunhis.point[b].y*dum+gijunhis.point[e].y)/(dum+1);
                gijun.point[b].z = (gijunhis.point[b].z*dum+gijunhis.point[e].z)/(dum+1);
                
                gijun.point[c].x = (gijunhis.point[c].x*dum+gijunhis.point[f].x)/(dum+1);
                gijun.point[c].y =(gijunhis.point[c].y*dum+gijunhis.point[f].y)/(dum+1);
                gijun.point[c].z = (gijunhis.point[c].z*dum+gijunhis.point[f].z)/(dum+1);

                drawtri(
                    {x:gijun.point[a].y*500/gijun.point[a].x+1280/2,y:gijun.point[a].z*500/gijun.point[a].x+720/2},
                    {x:gijun.point[b].y*500/gijun.point[b].x+1280/2,y:gijun.point[b].z*500/gijun.point[b].x+720/2},
                    {x:gijun.point[c].y*500/gijun.point[c].x+1280/2,y:gijun.point[c].z*500/gijun.point[c].x+720/2},color);

                for (var i = 0; i < 8; i++) {
                    gijun.point[i].x = gijunhis.point[i].x;
                    gijun.point[i].y = gijunhis.point[i].y;
                    gijun.point[i].z = gijunhis.point[i].z;
                }
            }
        }
        
        function render(){

           // canvas
            var cnvs = document.getElementById('canvas');
            // context
            var ctx = canvas.getContext('2d');

            ctx.clearRect(0, 0, cnvs.width, cnvs.height);
            /*
            if(Math.sqrt(gijun.point[0].x**2+gijun.point[0].y**2+gijun.point[0].z**2) < Math.sqrt(gijun.point[4].x**2+gijun.point[4].y**2+gijun.point[4].z**2)){
                drawgijunpoint_tri(0,1,2,'#FA58F4');
                drawgijunpoint_tri(0,2,3,'#FA58F4');
            }
            else{
                drawgijunpoint_tri(4,5,6,'#610B5E');
                drawgijunpoint_tri(4,6,7,'#610B5E');
            }

            if(Math.sqrt(gijun.point[0].x**2+gijun.point[0].y**2+gijun.point[0].z**2) > Math.sqrt(gijun.point[1].x**2+gijun.point[1].y**2+gijun.point[1].z**2)){
                drawgijunpoint_tri(1,2,5,'#B404AE');
                drawgijunpoint_tri(6,2,5,'#B404AE');
            }
            else{
                drawgijunpoint_tri(0,3,7,'#FF00FF');
                drawgijunpoint_tri(0,4,7,'#FF00FF');
            }
            
            if(Math.sqrt(gijun.point[1].x**2+gijun.point[1].y**2+gijun.point[1].z**2) > Math.sqrt(gijun.point[2].x**2+gijun.point[2].y**2+gijun.point[2].z**2)){
                drawgijunpoint_tri(2,3,7,'#B404AE');
                drawgijunpoint_tri(2,7,6,'#B404AE');
            }
            else{
                drawgijunpoint_tri(0,1,5,'#FF00FF');
                drawgijunpoint_tri(0,5,4,'#FF00FF');
            }*/
            
            for (var i = bfs_list.length-1; i >-1; i--) {
                if(map[Math.ceil(bfs_list[i].x)][Math.ceil(bfs_list[i].y)][Math.ceil(bfs_list[i].z)] == 1){
                    renderblock(bfs_list[i].x,bfs_list[i].y,bfs_list[i].z,'#A5DF00','#86B404');
                }
                else if(map[Math.ceil(bfs_list[i].x)][Math.ceil(bfs_list[i].y)][Math.ceil(bfs_list[i].z)] == 2){
                    renderblock(bfs_list[i].x,bfs_list[i].y,bfs_list[i].z,'#DF7401','#B45F04');
                }
                else if(map[Math.ceil(bfs_list[i].x)][Math.ceil(bfs_list[i].y)][Math.ceil(bfs_list[i].z)] == 3){
                    renderblock(bfs_list[i].x,bfs_list[i].y,bfs_list[i].z,'#6E6E6E','#585858');
                }
                else if(map[Math.ceil(bfs_list[i].x)][Math.ceil(bfs_list[i].y)][Math.ceil(bfs_list[i].z)] == 4){
                    renderblock(bfs_list[i].x,bfs_list[i].y,bfs_list[i].z,'#DF0101','#B40404');
                }
                else if(map[Math.ceil(bfs_list[i].x)][Math.ceil(bfs_list[i].y)][Math.ceil(bfs_list[i].z)] == 5){
                    renderblock(bfs_list[i].x,bfs_list[i].y,bfs_list[i].z,'#01DF01','#04B404');
                }
                else if(map[Math.ceil(bfs_list[i].x)][Math.ceil(bfs_list[i].y)][Math.ceil(bfs_list[i].z)] == 6){
                    renderblock(bfs_list[i].x,bfs_list[i].y,bfs_list[i].z,'#013ADF','#0431B4');
                }
            }
            
            drowbar();
        }

        function renderblock(x,y,z,c1,c2){
            
            x -= 150;
            y -= 150;
            z -= 150;

            var x2,y2,z2;
            x2 = (gijun.point[1].x - gijun.point[0].x) * x + (gijun.point[2].x - gijun.point[1].x) * y + (gijun.point[5].x - gijun.point[1].x) * z;
            y2 = (gijun.point[1].y - gijun.point[0].y) * x + (gijun.point[2].y - gijun.point[1].y) * y + (gijun.point[5].y - gijun.point[1].y) * z;
            z2 = (gijun.point[1].z - gijun.point[0].z) * x + (gijun.point[2].z - gijun.point[1].z) * y + (gijun.point[5].z - gijun.point[1].z) * z;

            for (var i = 0; i < 8; i++) {
                gijun.point[i].x += x2;
                gijun.point[i].y += y2;
                gijun.point[i].z += z2;
            }

            if(Math.sqrt(gijun.point[0].x**2+gijun.point[0].y**2+gijun.point[0].z**2) < Math.sqrt(gijun.point[4].x**2+gijun.point[4].y**2+gijun.point[4].z**2)){
                drawgijunpoint_tri(0,1,2,c2);
                drawgijunpoint_tri(0,2,3,c2);

                drawgijunpoint_tri2(0,1,2,2,3,0,c1,20);
                drawgijunpoint_tri2(0,2,3,2,0,1,c1,20);
            }
            else{
                drawgijunpoint_tri(4,5,6,c2);
                drawgijunpoint_tri(4,6,7,c2);

                drawgijunpoint_tri2(4,5,6,6,7,4,c1,20);
                drawgijunpoint_tri2(4,6,7,6,4,5,c1,20);
            }

            if(Math.sqrt(gijun.point[0].x**2+gijun.point[0].y**2+gijun.point[0].z**2) > Math.sqrt(gijun.point[1].x**2+gijun.point[1].y**2+gijun.point[1].z**2)){
                drawgijunpoint_tri(1,2,5,c2);
                drawgijunpoint_tri(6,2,5,c2);
                
                drawgijunpoint_tri2(1,2,5,6,5,2,c1,20);
                drawgijunpoint_tri2(6,2,5,1,5,2,c1,20);
            }
            else{
                drawgijunpoint_tri(0,3,7,c2);
                drawgijunpoint_tri(0,4,7,c2);
                
                drawgijunpoint_tri2(0,3,7,7,4,0,c1,20);
                drawgijunpoint_tri2(0,4,7,7,3,0,c1,20);
            }
            
            if(Math.sqrt(gijun.point[1].x**2+gijun.point[1].y**2+gijun.point[1].z**2) > Math.sqrt(gijun.point[2].x**2+gijun.point[2].y**2+gijun.point[2].z**2)){
                drawgijunpoint_tri(2,3,7,c2);
                drawgijunpoint_tri(2,7,6,c2);

                drawgijunpoint_tri2(2,7,6,7,2,3,c1,20);
                drawgijunpoint_tri2(2,3,7,7,6,2,c1,20);
            }
            else{
                drawgijunpoint_tri(0,1,5,c2);
                drawgijunpoint_tri(0,5,4,c2);
                
                drawgijunpoint_tri2(0,1,5,5,4,0,c1,20);
                drawgijunpoint_tri2(0,5,4,5,0,1,c1,20);
            }

            for (var i = 0; i < 8; i++) {
                gijun.point[i].x -= x2;
                gijun.point[i].y -= y2;
                gijun.point[i].z -= z2;
            }
        }

        function drowrect(x,y,w,h,c){
            var canvas = document.getElementById("canvas");
            if (canvas.getContext) {
                var ctx = canvas.getContext("2d");

                ctx.fillStyle = c;
                ctx.fillRect(Math.round(x), Math.round(y), Math.round(w), Math.round(h));
            }
        }

        function drowtext(x,y,c,t){
            var canvas = document.getElementById("canvas");
            if (canvas.getContext) {
                var ctx = canvas.getContext("2d");

                ctx.font = "bold 25px Gulim";
                ctx.textAlign = 'right';
                ctx.fillStyle = c;
                ctx.fillText(t,Math.round(x), Math.round(y));
            }
        }

        function drowbar(){
            drowrect(1280/2-1, 720/2-15, 2, 30,'#FFFFFF');
            drowrect(1280/2-15, 720/2-1, 30, 2,'#FFFFFF');

            drowrect(1280/2-75*6/2, 720-100, 75*6, 75,'#D8D8D8');
            drowrect(1280/2-75*6/2+75*(pl_item-1), 720-100, 75, 75,'#F2F2F2');
            var dumli = ['#A5DF00','#DF7401','#6E6E6E','#DF0101','#01DF01','#013ADF'];
            for (var i = 0; i < 6; i++) {
                drowrect(1280/2-75*6/2+25/2+75*i, 720-100+25/2, 50, 50,dumli[i]);
                drowtext(1280/2-75*6/2-25/2+75*(i+1),720-100+25/2+45,'#FFFFFF',pl_blsu[i]);
            }
                
        }

        function bfsstart(){
            for (var i = 0; i < 300; i++) {
                for (var j = 0; j < 300; j++) {
                    for (var k = 0; k < 300; k++) {
                        map2[i][j][k] = 0;
                    }
                }
            }
            bfs_list = [];
            gijunanglechange(1,-camera.y);
            gijunanglechange(0,-camera.x);
            var bfs_list2 = [[-gijun.origin.x/100+150,-gijun.origin.y/100+150,-gijun.origin.z/100+150,randerrange]];
            while(bfs_list2.length){
                var dum = bfs_list2.length;
                for (var i = 0; i < dum; i++) {
                    var dum2 = bfs_list2.shift();

                    var x = dum2[0];
                    var y = dum2[1];
                    var z = dum2[2];
                    var range = dum2[3];

                    var dumli = [[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]]
                    for (var j = 0; j < 6; j++) {
                        if(range-1 != 0 && x+dumli[j][0] >= 0 && x+dumli[j][0] < 300 && y+dumli[j][1] >= 0 && y+dumli[j][1] < 300 && z+dumli[j][2] >= 0 && z+dumli[j][2] < 300 && map2[Math.ceil(x+dumli[j][0])][Math.ceil(y+dumli[j][1])][Math.ceil(z+dumli[j][2])] == 0){
                            if(map[Math.ceil(x+dumli[j][0])][Math.ceil(y+dumli[j][1])][Math.ceil(z+dumli[j][2])] == 0)bfs_list2.push([x+dumli[j][0],y+dumli[j][1],z+dumli[j][2],range-1]);
                            map2[Math.ceil(x+dumli[j][0])][Math.ceil(y+dumli[j][1])][Math.ceil(z+dumli[j][2])] = 1;
                            bfs_list.push({x:Math.ceil(x+dumli[j][0]),y:Math.ceil(y+dumli[j][1]),z:Math.ceil(z+dumli[j][2])});
                        }
                    }
                }
            }
            gijunanglechange(0,camera.x);
            gijunanglechange(1,camera.y);
        }

        function gijunanglechange(m,p){
            if(!m){
                for (var i = 0; i < 8; i++) {
                    var dum = Math.atan2(gijun.point[i].x,gijun.point[i].y);
                    var dum1 = Math.sqrt(gijun.point[i].x**2 + gijun.point[i].y**2);
                    dum += p;
                    var dum2 = Math.sin(dum)*dum1;
                    var dum3 = Math.cos(dum)*dum1;    

                    gijun.point[i].x = dum2;
                    gijun.point[i].y = dum3;
                    
                }
                var dum = Math.atan2(gijun.origin.x,gijun.origin.y);
                var dum1 = Math.sqrt(gijun.origin.x**2 + gijun.origin.y**2);
                dum += p;
                var dum2 = Math.sin(dum)*dum1;
                var dum3 = Math.cos(dum)*dum1;    

                gijun.origin.x = dum2;
                gijun.origin.y = dum3;
            }
            else{
                for (var i = 0; i < 8; i++) {
                    var dum = Math.atan2(gijun.point[i].z,gijun.point[i].x);
                    var dum1 = Math.sqrt(gijun.point[i].z**2 + gijun.point[i].x**2);
                    dum -= p;
                    var dum2 = Math.sin(dum)*dum1;
                    var dum3 = Math.cos(dum)*dum1;    

                    gijun.point[i].z = dum2;
                    gijun.point[i].x = dum3;
                }
                var dum = Math.atan2(gijun.origin.z,gijun.origin.x);
                var dum1 = Math.sqrt(gijun.origin.z**2 + gijun.origin.x**2);
                dum -= p;
                var dum2 = Math.sin(dum)*dum1;
                var dum3 = Math.cos(dum)*dum1;    

                gijun.origin.z = dum2;
                gijun.origin.x = dum3;
            }
        }

        function plcol(){
            gijunanglechange(0,-camera.x);
            var a = 0;
            for (var i = 0; i < 3; i++) {
                if(map[Math.ceil(-gijun.origin.x/100+150-0.5)][Math.ceil(-gijun.origin.y/100+150-0.5)][Math.ceil(-gijun.origin.z/100+150-0.5+i*0.9)] != 0){a = 1;}
                if(map[Math.ceil(-gijun.origin.x/100+150-0.5-0.4)][Math.ceil(-gijun.origin.y/100+150-0.5-0.4)][Math.ceil(-gijun.origin.z/100+150-0.5+i*0.9)] != 0){a = 1;}
                if(map[Math.ceil(-gijun.origin.x/100+150-0.5+0.4)][Math.ceil(-gijun.origin.y/100+150-0.5-0.4)][Math.ceil(-gijun.origin.z/100+150-0.5+i*0.9)] != 0){a = 1;}
                if(map[Math.ceil(-gijun.origin.x/100+150-0.5-0.4)][Math.ceil(-gijun.origin.y/100+150-0.5+0.4)][Math.ceil(-gijun.origin.z/100+150-0.5+i*0.9)] != 0){a = 1;}
                if(map[Math.ceil(-gijun.origin.x/100+150-0.5+0.4)][Math.ceil(-gijun.origin.y/100+150-0.5+0.4)][Math.ceil(-gijun.origin.z/100+150-0.5+i*0.9)] != 0){a = 1;}
            }
            gijunanglechange(0,camera.x);
            return a;
        }

        function plblocknum(){
            gijunanglechange(1,-camera.y);
            gijunanglechange(0,-camera.x);
            var a = map[Math.ceil(-gijun.origin.x/100+150-0.5)][Math.ceil(-gijun.origin.y/100+150-0.5)][Math.ceil(-gijun.origin.z/100+150-0.5)];
            gijunanglechange(0,camera.x);
            gijunanglechange(1,camera.y);
            return a;
        }

        function move(){
            gijunanglechange(1,-camera.y);

            gijun.origin.z -= plg;
            for (var i = 0; i < 8; i++) {
                gijun.point[i].z -= plg;
            }
            plg+=2;
            if(plcol()){
                while(plcol()){
                    gijun.origin.z += -2*((plg<0)*2-1);
                    for (var i = 0; i < 8; i++) {
                        gijun.point[i].z += -2*((plg<0)*2-1);
                    }
                }
                
                plg=0;
                if(key.space){
                    plg = -20;
                }
            }


            if(key.w){
                gijun.origin.x -= 10;
                if(!plcol()){
                    for (var i = 0; i < 8; i++) {
                        gijun.point[i].x -= 10;
                    }
                }
                else{
                    gijun.origin.x += 10;
                }
                
            }
            if(key.a){
                gijun.origin.y += 10;
                if(!plcol()){
                    for (var i = 0; i < 8; i++) {
                        gijun.point[i].y += 10;
                    }
                }
                else{
                    gijun.origin.y -= 10;
                }
            }
            if(key.s){
                gijun.origin.x += 10;
                if(!plcol()){
                    for (var i = 0; i < 8; i++) {
                        gijun.point[i].x += 10;
                    }
                }
                else{
                    gijun.origin.x -= 10;
                }
            }
            if(key.d){
                gijun.origin.y -= 10;
                if(!plcol()){
                    for (var i = 0; i < 8; i++) {
                        gijun.point[i].y -= 10;
                    }
                }
                else{
                    gijun.origin.y += 10;
                }
            }
            gijunanglechange(1,camera.y);
        }

        function repeat(){
            move();
            render();
        }
    </script>

</head>
<body scroll="no">
    <canvas id="canvas" width="1280px" height="720" onclick='pointerlockon(document.getElementById("canvas"));'>

    </canvas>
    <script>
        setInterval(repeat,1000/30);   
        setInterval(bfsstart,1000);     
    </script>
</body>
</html>
